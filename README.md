# Sojourn
Sojourn is a flexible location collection service. It comprises of a mobile SDK for Android or iOS and a web based dashboard to manage your deployment. A core feature of Sojourn is it's efficient algorithm for collecting location data. Location services are not used until the device moves significantly.

The web dashboard provides a portal to manage your deployment. You can create and manage geofences and measure users dwell time at these locations. Basic reporting is available.

We recognise that every use case that requires location from a mobile device is different. With this in mind the system is highly customisable, giving developers the ability to trigger actions on data updates, and easily persist data in the cloud.

Features
* iOS & Android native SDKs
* Quick and easy integration.
* Power efficient algorithm for collecting location data.
* Highly customisable.
* Supports offline store and forward algorithms.
* JavaScript SDK available.
* Support for iBeacons.
* Support for circular geofences.
## Other features:
* Flexible cloud rules engine.
* Inbox
* Social Feeds
* Deep linking.
* System can support user sign-up and anonymous users.
* Email and SMS MFA.
* Web Dashboard
* Create and manage geofences
* Create and manage iBeacons
* Basic reporting active users, visits
* Export of location data
* Server support before and after save triggers.
* Custom rule logic can be implemented.
* Push notifications.
* Highly scalable system.

# Getting Started

### Android Studio Integration

Add this repository to the app-level build.gradle file:

```
allprojects {
    repositories {
        maven{ 
            url "https://raw.githubusercontent.com/MelroseCS/sojourn-android/stable/" 
        }
    }
}
```

Add the sojourn library and related dependencies to the dependencies declaration:

```
dependencies {
    compile 'com.melrose.sojourn:sojourn:0.0.1@aar'
    compile 'com.android.support:appcompat-v7:27.1.1'
    compile 'com.android.support:support-v4:27.1.1'
    compile 'com.google.android.gms:play-services-location:15.0.1'
    compile 'com.google.android.gms:play-services-maps:15.0.1'
    compile 'com.parse:parse-android:1.17.3'
    compile 'com.parse:parse-fcm-android:1.17.3'
    compile 'com.squareup.okhttp:okhttp:2.5.0'
    compile 'org.altbeacon:android-beacon-library:2+'
}
```

Import the library in java files with:

```
import com.melrosecomputing.sojourn.export.*;

```
## Enable Location 
To enable sojourn to start collecting location data you must explicitly enable it using the following.  This must be called after initialisation.

```
TODO
```

## Custom Attribute
You can apply custom attributes to the device record.  Exisintg values will be overwritten.  This will allow for example more complex rules around sending messages based on gender or team preference etc.

Data types supported: NSString, NSDate, NSNumber.

```
TODO
```

## Push Handling
Sojourn will require push to be enabled to notify users of new messages when the application is in the background.  There are a number of other system notifications that are silent.  That is no UI is shown in response to these messages.

### Store Push Token
The push token will need to be persisted in order to enable Sojourn to send pushes to the device.  Call the following API to store the push.  This should be called everytime you receive a push token from the OS.  As it may change.

```
TODO
```

### Handle Incoming Push
Push notification should be passed to Sojourn in order for them to be handled.  It is safe to pass every notification regardless of the intended recipient.

```
TODO
```

## Inbox
The inbox contains 0..* messages delivered by the platform.  These may be generated by a user entering or exiting a geofence or beacon.

### Get Inbox Messages
Retrieves the messages for the specific device.

```
TODO
```

### Get Inbox Totals
Gets the total number of messages in the inbox and the total number of unread messages in the inbox.

```
TODO
```

If an error occures then a value of -1 is passed to the block handler.

### Mark all Messages as Read
Marks all messages in the inbox as read.

```
TODO
```

### Mark a Message as Read
Marks a specific message identified by it's objectId as read.

```
TODO
```

### Delete a Message
Deletes a specific message identified by it's objectId.

```
TODO
```

### Delete all Messages
Deletes all messages.

```
TODO
```

## GDPR
Location data relating to individuals is very likely to be able to identify them. Hence it constitutes personal data and unless exemptions apply, the Data Protection Acts 1988 and 2003 (hereinafter called the ‘Data Protection Acts’) apply. It could also constitute sensitive data, and should therefore be handled carefully. Data controllers have a responsibility to minimise the amount of data collected, processed and retained because of risks posed by linked location data.

See here for more details:
[Guidance Note for Data Controllers on Location Data](https://www.dataprotection.ie/docs/Guidance-Note-for-Data-Controllers-on-Location-Data/1587.htm)
 
Informed consent is the most appropriate basis for processing personal location data in most cases.  This puts emphasis on the app developer to inform the user why they are collecting location data, what they are going to do with and how it will benefit the user.

To ensure Sojourn complies with GDPRs right to be forgotten we supply an API to allow users to mark their account as deleted.  This will record the users request to be forgotten and trigger an asynchronous process to delete the location data.

```
TODO
```
